# 更新日志

## 2025-11-06 - 添加日志功能

### 新增功能

1. **完整的日志系统**
   - 使用 Python 标准库 `logging` 模块
   - 同时输出到控制台和日志文件 `olmocr_app.log`
   - 日志格式包含时间戳、模块名、级别和消息

2. **详细的操作日志**
   - 应用启动信息(配置、端口、提供商等)
   - HTTP 请求日志(访问 IP、请求路径)
   - 文件上传详情(文件名、大小)
   - OCR 处理过程(命令、耗时、状态)
   - 结果生成信息(文件数量、内容大小)
   - 错误和异常详情(含完整堆栈跟踪)

3. **安全性改进**
   - API 密钥在日志中自动隐藏,显示为 `***`
   - 记录客户端 IP 地址用于审计

4. **性能监控**
   - 记录文件处理耗时
   - 记录文件大小和输出大小
   - 便于性能分析和优化

### 修改的文件

- `app.py`: 添加了 48 处日志记录点

### 新增的文件

- `LOGGING.md`: 日志使用说明文档
- `CHANGELOG.md`: 本更新日志

### 日志级别使用

- **INFO**: 正常操作流程(请求、处理、完成)
- **WARNING**: 警告信息(参数错误、格式不支持)
- **ERROR**: 错误信息(处理失败、超时)
- **DEBUG**: 调试信息(健康检查详情)

### 使用示例

查看实时日志:
```bash
tail -f olmocr_app.log
```

搜索错误:
```bash
grep "ERROR" olmocr_app.log
```

查看性能:
```bash
grep "耗时" olmocr_app.log
```

### 技术细节

- 代码行数: 283 行 (增加约 75 行)
- 日志调用: 48 处
- 日志文件: `olmocr_app.log`
- 日志格式: `%(asctime)s - %(name)s - %(levelname)s - %(message)s`

### 后续建议

1. 在生产环境中配置日志轮转
2. 考虑集成到日志分析平台
3. 根据需要调整日志级别
4. 定期清理旧日志文件
